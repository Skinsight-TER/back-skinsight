import { Injectable } from '@nestjs/common';
import axios from 'axios';

@Injectable()
export class IaService {
  apiUrl = 'http://localhost:1234/v1/completions';
  apiKey = 'not-needed';

  img =
    'data:image/jpeg;base64,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';

  async sendMessageIA() {
    const requestData = {
      model: 'local-model',
      message: [
        {
          role: 'system',
          content:
            'This is a chat between a doctor and an dermathologiste assistant. The assistant is helping the doctor to describe an image.',
        },
        {
          role: 'user',
          content: [
            { type: 'text', text: 'What’s in this image?' },
            {
              type: 'image_url',
              image_url: {
                url: `${this.img}`,
              },
            },
          ],
        },
      ],
      max_tokens: 1000,
      stream: true,
    };

    const headers = {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${this.apiKey}`,
    };

    try {
      const response = await axios.post(this.apiUrl, requestData, { headers });
      // Handle the response as needed
      const completionChunks = response.data.choices;
      completionChunks.forEach((chunk) => {
        if (chunk.delta && chunk.delta.content) {
          // console.log(chunk.delta.content);
        }
      });
    } catch (error) {
      console.error('Error making the request:', error.message);
      // Handle the error as needed
    }
    return 'toto';
  }
}
